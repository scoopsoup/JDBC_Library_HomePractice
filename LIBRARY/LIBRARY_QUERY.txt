--MANAGER 테이블 삭제
DROP TABLE MANAGER;

--MANAGER 테이블 생성
CREATE TABLE MANAGER
(
    MANAGER_NO NUMBER NOT NULL,
    MANAGER_NAME VARCHAR2(20) NOT NULL,
    MANAGER_ID VARCHAR2(20) PRIMARY KEY,
    MANAGER_PWD VARCHAR2(20) NOT NULL,
    MANAGER_BIRTH DATE NOT NULL,
    MANAGER_GENDER CHAR(1) CHECK(MANAGER_GENDER IN('M', 'F')),
    MANAGER_ADDR VARCHAR2(100) NOT NULL,
    MANAGER_ENROLL_DATE DATE DEFAULT SYSDATE
);

--MANAGER 테이블 컬럼명 작성
COMMENT ON COLUMN MANAGER.MANAGER_NO IS '관리자번호';
COMMENT ON COLUMN MANAGER.MANAGER_NAME IS '관리자이름';
COMMENT ON COLUMN MANAGER.MANAGER_ID IS '관리자아이디';
COMMENT ON COLUMN MANAGER.MANAGER_PWD IS '관리자비밀번호';
COMMENT ON COLUMN MANAGER.MANAGER_BIRTH IS '관리자생년월일';
COMMENT ON COLUMN MANAGER.MANAGER_GENDER IS '관리자성별';
COMMENT ON COLUMN MANAGER.MANAGER_ADDR IS '관리자주소';
COMMENT ON COLUMN MANAGER.MANAGER_ENROLL_DATE IS '발급날짜';

--CUSTOMER 테이블 삭제
DROP TABLE CUSTOMER;

--CUSTOMER 테이블 생성
CREATE TABLE CUSTOMER
(
    USER_NO NUMBER NOT NULL,
    USER_NAME VARCHAR2(20) NOT NULL,
    USER_ID VARCHAR2(20) PRIMARY KEY,
    USER_PWD VARCHAR2(20) NOT NULL,
    USER_BIRTH DATE NOT NULL,
    USER_GENDER CHAR(1) CHECK(USER_GENDER IN('M', 'F')),
    USER_ADDR VARCHAR2(100) NOT NULL,
    USER_ENROLL_DATE DATE DEFAULT SYSDATE
);

--CUSTOMER 테이블 컬럼명 작성
COMMENT ON COLUMN CUSTOMER.USER_NO IS '회원번호';
COMMENT ON COLUMN CUSTOMER.USER_NAME IS '회원이름';
COMMENT ON COLUMN CUSTOMER.USER_ID IS '회원아이디';
COMMENT ON COLUMN CUSTOMER.USER_PWD IS '회원비밀번호';
COMMENT ON COLUMN CUSTOMER.USER_BIRTH IS '회원생년월일';
COMMENT ON COLUMN CUSTOMER.USER_GENDER IS '회원성별';
COMMENT ON COLUMN CUSTOMER.USER_ADDR IS '회원주소';
COMMENT ON COLUMN CUSTOMER.USER_ENROLL_DATE IS '가입날짜';

--BOOK 테이블 삭제
DROP TABLE BOOK;

--BOOK 테이블 생성
CREATE TABLE BOOK
(
    BOOK_NO NUMBER PRIMARY KEY,
    BOOK_NAME VARCHAR2(20),
    BOOK_WRITER VARCHAR2(20),
    BOOK_PRICE NUMBER,
    PUBLISHER VARCHAR2(20),
    GENRE VARCHAR2(20)
);

--BOOK테이블 BOOK_NAME, BOOK_WRITER 데이터 길이 변경
ALTER TABLE BOOK MODIFY(BOOK_NAME VARCHAR2(50));
ALTER TABLE BOOK MODIFY(BOOK_WRITER VARCHAR2(50));

--BOOK 테이블 컬럼명 작성
COMMENT ON COLUMN BOOK.BOOK_NO IS '책번호';
COMMENT ON COLUMN BOOK.BOOK_NAME IS '책이름';
COMMENT ON COLUMN BOOK.BOOK_WRITER IS '저자';
COMMENT ON COLUMN BOOK.BOOK_PRICE IS '가격';
COMMENT ON COLUMN BOOK.PUBLISHER IS '출판사';
COMMENT ON COLUMN BOOK.GENRE IS '장르';

--LIBRARY_CUSTOMER 테이블 삭제
DROP TABLE LIBRARY_CUSTOMER;

--LIBRARY_CUSTOMER 테이블 생성
CREATE TABLE LIBRARY_CUSTOMER
(
    LEASE_NO NUMBER PRIMARY KEY,
    BOOK_NO NUMBER NOT NULL,
    USER_ID VARCHAR2(20) NOT NULL,
    LEASE_DATE DATE DEFAULT SYSDATE,
    RETURN_DATE DATE DEFAULT SYSDATE + 2,
    FOREIGN KEY (BOOK_NO) REFERENCES BOOK(BOOK_NO) ON DELETE CASCADE,
    FOREIGN KEY (USER_ID) REFERENCES CUSTOMER (USER_ID) ON DELETE CASCADE
);

--LIBRARY_CUSTOMER 테이블 컬럼명 작성
COMMENT ON COLUMN LIBRARY_CUSTOMER.LEASE_NO IS '대여번호';
COMMENT ON COLUMN LIBRARY_CUSTOMER.BOOK_NO IS '책번호';
COMMENT ON COLUMN LIBRARY_CUSTOMER.USER_ID IS '회원번호';
COMMENT ON COLUMN LIBRARY_CUSTOMER.LEASE_DATE IS '대여일';
COMMENT ON COLUMN LIBRARY_CUSTOMER.RETURN_DATE IS '반납일';

--LIBRARY_BOOK 테이블 삭제
DROP TABLE LIBRARY_BOOK;

--LIBRARY_BOOK 테이블 생성
CREATE TABLE LIBRARY_BOOK
(
    BOOK_NO NUMBER PRIMARY KEY,
    BOOK_NAME VARCHAR2(20) NOT NULL,
    BOOKQTY NUMBER DEFAULT 0
);

--LIBRARY_BOOK 테이블 컬럼명 작성
COMMENT ON COLUMN LIBRARY_BOOK.BOOK_NO IS '책번호';
COMMENT ON COLUMN LIBRARY_BOOK.BOOK_NAME IS '책이름';
COMMENT ON COLUMN LIBRARY_BOOK.BOOKQTY IS '책재고';

--시퀀스 생성
--CUSTOMER_SEQ 시퀀스 생성(CUSTOMER_NO에 쓰임)
CREATE SEQUENCE CUSTOMER_SEQ
START WITH 1
INCREMENT BY 1
MAXVALUE 1000
NOCYCLE
NOCACHE;

--MANAGER_SEQ 시퀀스 생성(MANAGER_NO에 쓰임)
CREATE SEQUENCE MANAGER_SEQ
START WITH 1
INCREMENT BY 1
MAXVALUE 1000
NOCYCLE
NOCACHE;

--BOOK_SEQ 시퀀스 생성(BOOK_NO에 쓰임)
CREATE SEQUENCE BOOK_SEQ
START WITH 1
INCREMENT BY 1
MAXVALUE 1000
NOCYCLE
NOCACHE;

--LIBRARY_SEQ 시퀀스 생성(LEASE_NO에 쓰임)
CREATE SEQUENCE LIBRARY_SEQ
START WITH 1
INCREMENT BY 1
MAXVALUE 1000
NOCYCLE
NOCACHE;




--최상위 메니저 등록(MANAGER_NO = 1)
INSERT INTO MANAGER VALUES(MANAGER_SEQ.NEXTVAL, '짱구', 'manager01', 'sinchan', '19940505', 'M', '서울특별시 초록구 떡잎마을', '20130302');

--커밋
COMMIT;


DESC MANAGER;
DESC CUSTOMER;
DESC BOOK;
DESC LIBRARY_CUSTOMER;
DESC LIBRARY_BOOK;

SELECT * FROM CUSTOMER;
SELECT * FROM MANAGER;
SELECT * FROM BOOK;